####!/bin/tcsh
# 
# copy (or link) this file to $LS4_ROOT/.login
# These environment variables are used by various
# scripts that implement the startup of the
# LS4 observing software.
#
# LS4_ROOT is the home directory for the "observer" user.
# It is defined in ".tcshrc" in the observer home direcory.

# CCP_HOST the name of the machine that runs the camera-control program.
setenv CCP_HOST ls4-workstn

# CCP_PORT is the TCP port for socket connections to the camera-control
# program
setenv CCP_PORT 6000
setenv CCP_STATUS_PORT 6001

# timeouts (sec) for commands to ccp
setenv SHUTDOWN_TIMEOUT 5 
setenv STATUS_TIMEOUT 5

alias reset_obs 'unsetenv login_done;source  ~/.login'
alias testloop '~/ls4_control/scripts/test_loop.csh'
alias startccp '~/ls4_control/scripts/start_ccp.bash'
alias stopccp 'echo shutdown | netcat -w $SHUTDOWN_TIMEOUT -N $CCP_HOST $CCP_PORT'
alias abortexp '~/ls4_control/scripts/abort_exposure.bash'
alias abortccp '~/ls4_control/scripts/abort_server.bash'
alias killccp 'slay run_ccp'
alias ccpstatus 'echo status | netcat -w $STATUS_TIMEOUT -N $CCP_HOST $CCP_STATUS_PORT | sed -e "s/{//g" | sed -e "s/}//g"'
alias telstatus 'telescope_status'
alias archongui '~/ls4_control/gui/release/archongui -small'

alias mos '~/ls4_control/scripts/make_mosaics.csh'


#if ( ! $?login_done ) then

if ( ! $?prompt ) then
   setenv prompt "%U%m%u:%B%~%b%#"
endif

if ( ! $?LS4_ROOT ) then
   echo "LS4_ROOT is not defined in ~/.tcshrc of observers home directory"
   exit
endif

setenv FAKE_TELESCOPE  0
setenv FAKE_CAMERA 0
setenv FAKE_UT_OFFSET 0.0
setenv FAKE_UT_DATE 0


# For simulated observations set FAKE_OBS = 1
setenv FAKE_OBS 0

if ( $FAKE_OBS == 1 ) then
  # when simulating observations, set FAKE_CAMERA and/or  FAKE_TELESCOPE to 1.
  # This will force the camera and/or telescope servers to make return
  # responses simulating actual responses from the respective hardware.
  setenv FAKE_CAMERA 1
  setenv FAKE_TELESCOPE 1
  # add offset to current UT time (hours) to simulate observations at a later
  # time of day then the actuall time.
  setenv FAKE_UT_OFFSET 0.0  
  # set FAKE_UT_DATE to 1 to adjust UT date to value expected during nigh-tome
  # observing (i.e. 1 day later than the current UT date)
  setenv FAKE_UT_DATE   0

endif


if ( $FAKE_TELESCOPE ) then
   setenv SITE_NAME "Fake"
else
   setenv SITE_NAME "ESO_SCHMIDT"
endif

# Set to 1 to allow ops with dome closed, 0 otherwise
setenv OVERRIDE_DOME "1" 

# Set TRANSFER_FLAG to 1 package and transfer data as they are acquired.
setenv TRANSFER_FLAG 0

# Set VERBOSE_FLAG to 1 (or higher) for verbose message logs
setenv VERBOSE_FLAG 2
#
# LS4_DATA_DIR is where images are stored.
if ( $FAKE_OBS ) then
  setenv LS4_DATA_DIR /data/observer/fake
else
  setenv LS4_DATA_DIR /data/observer
endif

# QUESTNEATDATADIR = DATA_DIR, and is sourced by old scripts
setenv QUESTNEATDATADIR $LS4_DATA_DIR

# LS4_CONTROL_ROOT is the location of the camera control code
setenv LS4_CONTROL_ROOT $LS4_ROOT/ls4_control

# LS4_SCHEDULER_ROOT is the locations of the scheduler code.
setenv LS4_SCHEDULER_ROOT $LS4_ROOT/scheduler

# SCHEDULER_PROGRAM is the directory path for the scheduler code
setenv SCHEDULER_PROGRAM $LS4_SCHEDULER_ROOT/bin/scheduler

# OBSPLAN_DIR is the directory where nightly obsplans are stored
setenv OBSPLAN_DIR $LS4_ROOT/obsplans

# LOG_DIR is the location where message logs are written.
setenv LOG_DIR $LS4_ROOT/logs

# CCP_LOG_LEVEL sets the message content of log for the camera control
# program. Use "DEBUG" for more verbosity, "ERROR" for error-messages
# only.
setenv CCP_LOG_LEVEL "INFO"

# CCP_LOG is the location for the camera-control log.
setenv CCP_LOG $LOG_DIR/ccp.log

# OFFSET_FILE has to offsets to add to ra and dec to achieve accurate pointing
setenv OFFSET_FILE  "$LS4_ROOT/telescope_offsets.dat"

# OFFSET_LOG is the file location for the output log
# of the script that determines corrections to the telescope pointing.
setenv OFFSET_LOG $LOG_DIR/telescope_offsets.log

# STARTOBS_LOG is the file location for the output log of the
# script that starts the nightly observing program.
setenv STARTOBS_LOG $LOG_DIR/startobs.log

#  CCP_STATUS_PORT is the TCP port for status commands to the camera-control
# program
setenv CCP_STATUS_PORT 6001
setenv STATUS_PORT $CCP_STATUS_PORT

setenv PYTHON_VENV $LS4_ROOT/observer_venv

setenv WEATHER_FILE $LS4_ROOT/logs/weather.tmp
setenv WEATHER_CLIENT $LS4_ROOT/bin/weather_client.pl

setenv TCS_PROG_NAME $LS4_ROOT/bin/tcs_talk_client.pl
setenv TCS_STATUS_FILE $LS4_ROOT/logs/tcs.status

# amp selection can be "both", "left", or "right"
setenv CCD_AMP_SELECTION "both"
#setenv CCD_AMP_SELECTION "left"
setenv login_done "1"
#endif
